name: Scrap Workflow

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  schedule:
    - cron: '0 * * * *'

jobs:
  run-scraper:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.8.18' # Specify exact version for consistency

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; else echo "requirements.txt not found"; exit 1; fi

      - name: Set environment variables
        env:
          MONGO_COLLECTION: ${{ secrets.MONGO_COLLECTION }}
          MONGO_DB: ${{ secrets.MONGO_DB }}
          MONGO_HOST: ${{ secrets.MONGO_HOST }}
          MONGO_PASSWORD: ${{ secrets.MONGO_PASSWORD }}
          MONGO_USER: ${{ secrets.MONGO_USER }}
        run: |
          echo "MONGO_COLLECTION: $MONGO_COLLECTION"
          echo "MONGO_DB: $MONGO_DB"
          echo "MONGO_HOST: $MONGO_HOST"
          echo "MONGO_USER: $MONGO_USER"
          if [ -z "$MONGO_COLLECTION" ] || [ -z "$MONGO_DB" ] || [ -z "$MONGO_HOST" ] || [ -z "$MONGO_USER" ] || [ -z "$MONGO_PASSWORD" ]; then
            echo "Error: One or more environment variables are unset"
            exit 1
          fi
          python main.py || { echo "Script failed with exit code $?"; exit 1; }